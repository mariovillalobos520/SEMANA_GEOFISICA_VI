var screen9=function(e){"use strict";class t{constructor(e){this.callbackMap=e}shift(e,t){const i=this.getCallbacks(e,t);if(i.length<1)return!1;const o=i.shift();return this.remove(e,t,o),o}store(e,t,i){const o=this.callbackMap.get(e)||{};t in o||(o[t]=[]),o[t].push(i),this.callbackMap.set(e,o)}remove(e,t,i){const o=this.callbackMap.get(e)||{};if(!o[t])return!0;if(!i)return o[t]=[],this.callbackMap.set(e,o),!0;const s=o[t].indexOf(i);return s>=0&&o[t].splice(s,1),this.callbackMap.set(e,o),o[t]&&0===o[t].length}getCallbacks(e,t){return(this.callbackMap.get(e)||{})[t]||[]}}class i{cloneElement(e){const t=this.getNode(e);if(!t)throw new Error("HTML element doesn't exist!");return t.cloneNode(!0)}getNode(e){return"string"==typeof e?document.getElementById(e):e}}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t.config&&Object.prototype.hasOwnProperty.call(t.config,e)?t.config[e]:null}function s(e,t){const i='<iframe allowfullscreen frameborder="0"                                src="'+n(e)+'"                                style="position:absolute;top:0;left:0;width:100%;height:100%;"                                referrerpolicy="no-referrer-when-downgrade"                                allow="accelerometer; autoplay; encrypted-media; fullscreen;                                    gyroscope; picture-in-picture">                              </iframe>';if(!t.parentNode)return t.innerHTML=i,t;const s=document.createElement("div");return t.id&&(s.id=t.id),t.className&&(s.className=t.className),s.setAttribute("style","padding:"+function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"16:9";const i=o("aspectRatio",e)||t;if(!i)return NaN;const s=i.split(":");return s[1]/s[0]*100}(e)+"% 0 0 0;position:relative;"),s.innerHTML=i,t.parentNode.replaceChild(s,t),s}function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.apiEmbedURL||"https://api.screen9.com/embed";t+=e.mediaid?"/"+e.mediaid:"";let i=t.indexOf("?")>=0?"&":"?",s="";return["ads","airplay","allowedCookies","autoplay","chapters","chromecast","controls","endTime","language","logo","loop","muted","playsinline","poster","recommend","share","startTime","title","trackingid","videoposter"].forEach(t=>{const n=o(t,e);null!==n&&(s+=i+function(e,t){let i=e.toLowerCase(),o=t;if("muted"===e)i="mute";else if("videoposter"===e&&"object"==typeof t){if(o=!0,Object.keys(t).length>0)for(const i in t)i in t&&(o+=`&${e}.${i.toLowerCase()}=${t[i]}`)}else Array.isArray(t)&&(o=t.toString());return i+"="+o}(t,n),i="&")}),t+s}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*";this.callback=e,this.origin=t}parseMessage(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return{}}return e}postMessage(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.contentWindow||!e.contentWindow.postMessage)return;const o={method:t};void 0!==i&&(o.value=i),e.contentWindow.postMessage(o,this.origin)}processData(e,t){t=this.parseMessage(t);let i,o=[];const s=e.iframe;if(t.event){if("error"===t.event&&"object"==typeof t.value&&t.value.method){this.callback.getCallbacks(s,t.value.method).forEach(e=>{e.reject(new Error(t.value.message||"")),this.callback.remove(s,t.value.method,e)})}o=this.callback.getCallbacks(s,`event:${t.event}`);try{i=new Event(t.event,{bubbles:!0,cancelable:!0})}catch(e){i=document.createEvent("Event"),i.initEvent(t.event,!0,!0)}i.params=t.value}else if(t.method){const e=this.callback.shift(s,t.method);e&&(o.push(e),i=t.value)}o.forEach(t=>{try{if("function"==typeof t){if(i&&i.cancelBubble)return;return void t.call(e,i)}t.resolve(i)}catch(e){}})}}let r=function(e){return e.AMBER="amber",e}({}),l={amber:{className:"Amber",classRef:void 0,libs:{}}};const c=new WeakMap,h=new WeakMap,d="recommendationclick",f="invokeloadmedia";return e.PLAYERS=r,e.Player=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e;const o=e.playerName||r.AMBER;this.playerSpec=this.getPlayerSpec(o),e.config=e.config||{containerid:e.containerid},this.containerid=e.containerid||e.config.containerid,this.callback=new t(c),this.messageUtils=new a(this.callback);const l=new i;let u=l.getNode(this.containerid);if(!u)throw new Error(`The Player 'containerid' option: ${this.containerid} is wrong or not set!`);this.iframe="IFRAME"===u.nodeName?u:void 0,this.containerParent=u.parentElement,this.containerClone=l.cloneElement(u);const g=new Promise((t,i)=>{if("VIDEO"===u.nodeName||"AUDIO"===u.nodeName){if(!this.playerSpec.classRef)return void i(new Error(`The player can not use '${u.nodeName}' tag for embedding.\n                    Try to use <iframe> instead.`));this.loadMedia({apiURL:e.apiURL,config:e.config,fetchConfig:e.fetchConfig,mediaid:e.mediaid,token:e.token,trackingid:e.trackingid},!0).then(e=>{t(e)}).catch(e=>{i(e)})}else{const o=e=>{if(!this.iframe||this.iframe.contentWindow!==e.source)return;"*"===this.messageUtils.origin&&(this.messageUtils.origin=e.origin);const o=this.messageUtils.parseMessage(e.data);if("event"in o&&"error"===o.event&&o.value&&"ready"===o.value.method)return void i(new Error(o.value.message));if("method"in o&&"ping"===o.method)return this.messageUtils.postMessage(this.iframe,"pong"),this.iframe.setAttribute("data-ready","true"),void t(void 0);this.messageUtils.processData(this,o)};this.iframe?this.iframe.hasAttribute("src")||this.iframe.setAttribute("src",n(e)):(u=s(e,u),this.disposeIframeContainer=!0,this.iframe=u.querySelector("iframe")),window.addEventListener("message",o,!1)}});h.set(this,g),this.invokeLoadMediaAction=this.invokeLoadMediaAction.bind(this),this.on(d,this.invokeLoadMediaAction),this.on(f,this.invokeLoadMediaAction),this.iframe?this.messageUtils.postMessage(this.iframe,"ping"):(this.on("pong",()=>{this.pong=!0,this.off(d,this.invokeLoadMediaAction),this.off(f,this.invokeLoadMediaAction)}),this.on("api:loadmedia",e=>{const t=e.params;this.loadMedia(t.mediaElm,t.resolveOnLoad).then(()=>{this.player.postMessage("loadMedia")}).catch(e=>{this.player.postEvent("error",{message:"string"==typeof e?e:e.message,method:"loadMedia"})})}))}dispose(){return this.iframe?new Promise(e=>{this.player=void 0,this.isDisposed=!0,h.delete(this),this.iframe.parentNode&&(this.disposeIframeContainer?(this.iframe.parentElement.remove(),this.disposeIframeContainer=!1):this.iframe.parentNode.removeChild(this.iframe)),e()}):this.callMethod("dispose").then(()=>{this.player=void 0,this.isDisposed=!0,h.delete(this)})}getAutoplay(){return this.callMethod("getAutoplay")}getBuffered(){return this.callMethod("getBuffered")}getBufferedEnd(){return this.callMethod("getBufferedEnd")}getAllowedCookies(){return this.callMethod("getAllowedCookies")}getColors(){return this.callMethod("getColors")}getCurrentTime(){return this.callMethod("getCurrentTime")}getCurrentTimeInISOString(){return this.callMethod("getCurrentTimeInISOString")}getDuration(){return this.callMethod("getDuration")}getEnded(){return this.callMethod("getEnded")}getError(){return this.callMethod("getError")}getLoop(){return this.callMethod("getLoop")}getMuted(){return this.callMethod("getMuted")}getPaused(){return this.callMethod("getPaused")}getPlaybackRate(){return this.callMethod("getPlaybackRate")}getVolume(){return this.callMethod("getVolume")}loadMedia(e,t){return this.iframe?this.callMethod("loadMedia",{mediaElm:e,resolveOnLoad:t}):new Promise((i,o)=>{const s="api.screen9.com",n=`https://${s}/player/config`;let a,r;if("string"==typeof e?a={apiURL:n,config:{},mediaid:e,token:this.options.token,trackingid:this.options.trackingid}:(a=e||{},a.apiURL=e.apiURL||n,a.config=e.config||{},a.mediaid=e.mediaid),null===a.mediaid?(r=!0,a.mediaid=this.media.mediaid):a.mediaid=a.mediaid||a.config.mediaid,a.config.src||a.config.error||!1===a.fetchConfig)this.buildPlayer(a.config,this.containerid,t).then(e=>{i(e)}).catch(e=>{o(e)});else{a.mediaid||o(new Error('"mediaid" property can\'t be null or undefined.'));const e=function(e,t,i,o){let s=t.mediaid;if(e){if(t.config.configUrl)return t.config.configUrl;const{hostname:e="",pathname:n="/"}=i;-1!==e.indexOf(o)&&(s=n.split("/").slice(-1)[0])}return`${t.apiURL}/${s}`}(r,a,document.location,s);fetch(e+function(e){const t=Object.keys(e);return t.length?`?${t.map(t=>`${t}=${encodeURIComponent(e[t])}`).join("&")}`:""}(function(e){const t={token:e.token,trackingid:e.trackingid};return Object.keys(t).filter(e=>null!=t[e]).reduce((e,i)=>(e[i]=t[i],e),{})}(a))).then(e=>e.json()).then(e=>{a.config=this.mergeOptions(e,a.config),this.propagateStatisticsPluginConfig(a.config),this.buildPlayer(a.config,this.containerid,t).then(e=>{i(e)}).catch(e=>{o(e)})}).catch(e=>{o(new Error(`We couldn't load player config: '${e}'`))})}this.media=a})}off(e,t){if(this.iframe){this.callback.remove(this.iframe,`event:${e}`,t)&&this.callMethod("off",e).catch(e=>{})}else this.callMethod("off",e,t)}on(e,t){if(this.iframe){0===this.callback.getCallbacks(this.iframe,`event:${e}`).length&&this.callMethod("on",e).catch(()=>{}),this.callback.store(this.iframe,`event:${e}`,t),e===d&&(this.callback.remove(this.iframe,`event:${e}`,this.invokeLoadMediaAction),this.callback.store(this.iframe,`event:${e}`,this.invokeLoadMediaAction))}else this.callMethod("on",e,t),e!==d||this.pong||(this.off(d,this.invokeLoadMediaAction),this.callMethod("on",e,this.invokeLoadMediaAction))}pause(){return this.callMethod("pause")}play(){return this.callMethod("play")}ready(){const e=h.get(this)||new Promise((e,t)=>{t(new Error("Player not found! Probably disposed."))});return Promise.resolve(e)}reset(){return this.callMethod("reset")}setAutoplay(e){return this.callMethod("setAutoplay",e)}setAllowedCookies(e){return void 0===e?Promise.reject(new Error("You must pass a parameter. Use null value to clear an existing allowed cookies settings.")):this.callMethod("setAllowedCookies",e)}setColors(e){return this.callMethod("setColors",e)}setCurrentTime(e){return this.callMethod("setCurrentTime",e)}setLoop(e){return this.callMethod("setLoop",e)}setMute(e){return this.callMethod("setMute",e)}setPlaybackRate(e){return this.callMethod("setPlaybackRate",e)}setVolume(e){return this.callMethod("setVolume",e)}mergeOptions(){const e={},t=Object.prototype.toString,i=e=>!!e&&"object"==typeof e,o=(e,t)=>{(e=>i(e)?Object.keys(e):[])(e).forEach(i=>t(e[i],i))},s=e=>i(e)&&"[object Object]"===t.call(e)&&e.constructor===Object;for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return a.forEach(t=>{t&&o(t,(t,i)=>{s(t)?(s(e[i])||(e[i]={}),e[i]=this.mergeOptions(e[i],t)):e[i]=t})}),e}buildPlayer(e,t,i){return new Promise((o,s)=>{e.containerid=e.containerid?e.containerid:t,this.isDisposed&&this.containerClone&&this.containerParent&&this.initContainer(),this.initPlayer(e,i).then(e=>{o(e)}).catch(e=>{s(e)})})}propagateStatisticsPluginConfig(e){const t=e.statisticsSessionid||e.statisticsOldSessionid,i=e.plugins&&e.plugins.statistics;t&&i&&(i.sessionid=e.statisticsSessionid,i.oldSessionid=e.statisticsOldSessionid)}callMethod(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return this.iframe?new Promise((t,o)=>this.ready().then(()=>{this.callback.store(this.iframe,e,{reject:o,resolve:t}),this.messageUtils.postMessage(this.iframe,e,...i)}).catch(e=>{o(e)})):this.ready().then(()=>this.player[e](...i))}initContainer(){this.isDisposed=!1,this.containerParent.appendChild(this.containerClone.cloneNode())}initPlayer(e,t){const i=new Promise((i,o)=>{this.player=this.player||new this.playerSpec.classRef(e),this.player.init(e).then(o=>{if(t||o.resolveOnLoad)i(o);else{let e;const t=()=>{e||(e=!0,i(o))};this.player.one("durationchange",t),this.player.one("suspend",t)}o.ignoreLoad||this.player.load(e.src)}).catch(e=>{o(e)})});return h.get(this)||h.set(this,i),i}getPlayerSpec(e){const t=l[e];if(!t)throw new Error(`We couldn't find specified player name: '${e}' on the page`);return t}invokeLoadMediaAction(e){const{mediaid:t,config:i,fetchConfig:o}=e.params||{},s={mediaid:t,config:i||{autoplay:!0}};"boolean"==typeof o&&(s.fetchConfig=o),this.loadMedia(s)}},e}({});
